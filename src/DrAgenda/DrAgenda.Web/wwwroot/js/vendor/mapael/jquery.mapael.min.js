!function(t){"object"==typeof exports?module.exports=t(require("jquery"),require("raphael"),require("jquery-mousewheel")):"function"==typeof define&&define.amd?define(["jquery","raphael","mousewheel"],t):t(jQuery,Raphael,jQuery.fn.mousewheel)}(function(z,C,t,L){"use strict";var g="mapael",i=function(t,e){var a=this;a.container=t,a.$container=z(t),a.options=a.extendDefaultOptions(e),a.zoomTO=0,a.zoomCenterX=0,a.zoomCenterY=0,a.previousPinchDist=0,a.zoomData={zoomLevel:0,zoomX:0,zoomY:0,panX:0,panY:0},a.resizeTO=0,a.panning=!1,a.panningTO=0,a.animationIntervalID=null,a.$map=z("."+a.options.map.cssClass,a.container),a.initialMapHTMLContent=a.$map.html(),a.createdLegends={},a.$tooltip={},a.paper={},a.areas={},a.plots={},a.links={},a.mapConf={},a.init()};return i.prototype={version:"2.1.0",init:function(){var a=this;if(""===a.options.map.cssClass||0===z("."+a.options.map.cssClass,a.container).length)throw new Error("The map class `"+a.options.map.cssClass+"` doesn't exists");if(a.$tooltip=z("<div>").addClass(a.options.map.tooltip.cssClass).css("display","none"),a.$map.empty().append(a.$tooltip),z[g]&&z[g].maps&&z[g].maps[a.options.map.name])a.mapConf=z[g].maps[a.options.map.name];else{if(!(z.fn[g]&&z.fn[g].maps&&z.fn[g].maps[a.options.map.name]))throw new Error("Unknown map '"+a.options.map.name+"'");a.mapConf=z.fn[g].maps[a.options.map.name],window.console&&window.console.warn&&window.console.warn("Extending $.fn.mapael is deprecated (map '"+a.options.map.name+"')")}if(a.paper=new C(a.$map[0],a.mapConf.width,a.mapConf.height),!0===a.isRaphaelBBoxBugPresent())throw a.destroy(),new Error("Can't get boundary box for text (is your container hidden? See #135)");a.$container.addClass(g),a.options.map.tooltip.css&&a.$tooltip.css(a.options.map.tooltip.css),a.paper.setViewBox(0,0,a.mapConf.width,a.mapConf.height,!1),a.options.map.width?(a.paper.setSize(a.options.map.width,a.mapConf.height*(a.options.map.width/a.mapConf.width)),a.createLegends("plot",a.plots,a.options.map.width/a.mapConf.width)):a.handleMapResizing(),z.each(a.mapConf.elems,function(t){var e=a.getElemOptions(a.options.map.defaultArea,a.options.areas[t]?a.options.areas[t]:{},a.options.legend.area);a.areas[t]={mapElem:a.paper.path(a.mapConf.elems[t]).attr(e.attrs)}}),a.options.map.beforeInit&&a.options.map.beforeInit(a.$container,a.paper,a.options),z.each(a.mapConf.elems,function(t){var e=a.getElemOptions(a.options.map.defaultArea,a.options.areas[t]?a.options.areas[t]:{},a.options.legend.area);a.initElem(a.areas[t],e,t)}),a.links=a.drawLinksCollection(a.options.links),z.each(a.options.plots,function(t){a.plots[t]=a.drawPlot(t)}),a.$container.on("zoom."+g,function(t,e){a.onZoomEvent(t,e)}),a.options.map.zoom.enabled&&a.initZoom(a.mapConf.width,a.mapConf.height,a.options.map.zoom),a.options.map.zoom.init!==L&&(a.options.map.zoom.init.animDuration===L&&(a.options.map.zoom.init.animDuration=0),a.$container.trigger("zoom",a.options.map.zoom.init)),a.createLegends("area",a.areas,1),a.$container.on("update."+g,function(t,e){a.onUpdateEvent(t,e)}),a.$container.on("showElementsInRange."+g,function(t,e){a.onShowElementsInRange(t,e)}),a.options.map.afterInit&&a.options.map.afterInit(a.$container,a.paper,a.areas,a.plots,a.options),z(a.paper.desc).append(" and Mapael "+a.version+" (https://www.vincentbroute.fr/mapael/)")},destroy:function(){var t=this;for(var e in t.$container.off("."+g),t.$map.off("."+g),t.onResizeEvent&&z(window).off("resize."+g,t.onResizeEvent),t.$map.empty(),t.$map.html(t.initialMapHTMLContent),t.createdLegends)t.createdLegends[e].container.empty(),t.createdLegends[e].container.html(t.createdLegends[e].initialHTMLContent);t.$container.removeClass(g),t.$container.removeData(g),t.container=L,t.$container=L,t.options=L,t.paper=L,t.$map=L,t.$tooltip=L,t.mapConf=L,t.areas=L,t.plots=L,t.links=L},handleMapResizing:function(){var i=this;i.onResizeEvent=function(){clearTimeout(i.resizeTO),i.resizeTO=setTimeout(function(){i.$map.trigger("resizeEnd")},150)},z(window).on("resize."+g,i.onResizeEvent),i.$map.on("resizeEnd."+g,function(t,e){var a=i.$map.width();if(i.paper.width!=a){var o=a/i.mapConf.width;i.paper.setSize(a,i.mapConf.height*o),(e||i.options.legend.redrawOnResize)&&i.createLegends("plot",i.plots,o)}}).trigger("resizeEnd",[!0])},extendDefaultOptions:function(o){return o=z.extend(!0,{},i.prototype.defaultOptions,o),z.each(["area","plot"],function(t,e){if(z.isArray(o.legend[e]))for(var a=0;a<o.legend[e].length;++a)o.legend[e][a]=z.extend(!0,{},i.prototype.legendDefaultOptions[e],o.legend[e][a]);else o.legend[e]=z.extend(!0,{},i.prototype.legendDefaultOptions[e],o.legend[e])}),o},initElem:function(t,e,a){var o=this,i={},n={};e.value!==L&&(t.value=e.value),e.text&&e.text.content!==L&&(i=t.mapElem.getBBox(),n=o.getTextPosition(i,e.text.position,e.text.margin),e.text.attrs["text-anchor"]=n.textAnchor,t.textElem=o.paper.text(n.x,n.y,e.text.content).attr(e.text.attrs),z(t.textElem.node).attr("data-id",a)),e.eventHandlers&&o.setEventHandlers(a,e,t.mapElem,t.textElem),o.setHoverOptions(t.mapElem,e.attrs,e.attrsHover),t.textElem&&o.setHoverOptions(t.textElem,e.text.attrs,e.text.attrsHover),(!1===z.isEmptyObject(e.attrsHover)||t.textElem&&!1===z.isEmptyObject(e.text.attrsHover))&&o.setHover(t.mapElem,t.textElem),e.tooltip&&(t.mapElem.tooltip=e.tooltip,o.setTooltip(t.mapElem),e.text&&e.text.content!==L&&(t.textElem.tooltip=e.tooltip,o.setTooltip(t.textElem))),e.href&&(t.mapElem.href=e.href,t.mapElem.target=e.target,o.setHref(t.mapElem),e.text&&e.text.content!==L&&(t.textElem.href=e.href,t.textElem.target=e.target,o.setHref(t.textElem))),e.cssClass!==L&&z(t.mapElem.node).addClass(e.cssClass),z(t.mapElem.node).attr("data-id",a)},initZoom:function(p,l,m){var h=this,c=!1,d=0,f=0,o={reset:function(){h.$container.trigger("zoom",{level:0})},in:function(){h.$container.trigger("zoom",{level:"+1"})},out:function(){h.$container.trigger("zoom",{level:-1})}};z.extend(h.zoomData,{zoomLevel:0,panX:0,panY:0}),z.each(m.buttons,function(t,e){if(o[t]===L)throw new Error("Unknown zoom button '"+t+"'");var a=z("<div>").addClass(e.cssClass).html(e.content).attr("title",e.title);a.on("click."+g,o[t]),h.$map.append(a)}),h.options.map.zoom.mousewheel&&h.$map.on("mousewheel."+g,function(t){var e=0<t.deltaY?1:-1,a=h.mapPagePositionToXY(t.pageX,t.pageY);h.$container.trigger("zoom",{fixedCenter:!0,level:h.zoomData.zoomLevel+e,x:a.x,y:a.y}),t.preventDefault()}),h.options.map.zoom.touch&&(h.$map.on("touchstart."+g,function(t){2===t.originalEvent.touches.length&&(h.zoomCenterX=(t.originalEvent.touches[0].pageX+t.originalEvent.touches[1].pageX)/2,h.zoomCenterY=(t.originalEvent.touches[0].pageY+t.originalEvent.touches[1].pageY)/2,h.previousPinchDist=Math.sqrt(Math.pow(t.originalEvent.touches[1].pageX-t.originalEvent.touches[0].pageX,2)+Math.pow(t.originalEvent.touches[1].pageY-t.originalEvent.touches[0].pageY,2)))}),h.$map.on("touchmove."+g,function(t){var e=0,a=0;if(2===t.originalEvent.touches.length){if(e=Math.sqrt(Math.pow(t.originalEvent.touches[1].pageX-t.originalEvent.touches[0].pageX,2)+Math.pow(t.originalEvent.touches[1].pageY-t.originalEvent.touches[0].pageY,2)),15<Math.abs(e-h.previousPinchDist)){var o=h.mapPagePositionToXY(h.zoomCenterX,h.zoomCenterY);a=(e-h.previousPinchDist)/Math.abs(e-h.previousPinchDist),h.$container.trigger("zoom",{fixedCenter:!0,level:h.zoomData.zoomLevel+a,x:o.x,y:o.y}),h.previousPinchDist=e}return!1}})),h.$map.on("dragstart",function(){return!1}),z("body").on("mouseup."+g+(m.touch?" touchend."+g:""),function(){c=!1,setTimeout(function(){h.panning=!1},50)}),h.$map.on("mousedown."+g+(m.touch?" touchstart."+g:""),function(t){t.pageX!==L?(c=!0,d=t.pageX,f=t.pageY):1===t.originalEvent.touches.length&&(c=!0,d=t.originalEvent.touches[0].pageX,f=t.originalEvent.touches[0].pageY)}).on("mousemove."+g+(m.touch?" touchmove."+g:""),function(t){var e=h.zoomData.zoomLevel,a=0,o=0;if(t.pageX!==L?(a=t.pageX,o=t.pageY):1===t.originalEvent.touches.length?(a=t.originalEvent.touches[0].pageX,o=t.originalEvent.touches[0].pageY):c=!1,c&&0!==e){var i=(d-a)/(1+e*m.step)*(p/h.paper.width),n=(f-o)/(1+e*m.step)*(l/h.paper.height),r=Math.min(Math.max(0,h.paper._viewBox[0]+i),p-h.paper._viewBox[2]),s=Math.min(Math.max(0,h.paper._viewBox[1]+n),l-h.paper._viewBox[3]);return(5<Math.abs(i)||5<Math.abs(n))&&(z.extend(h.zoomData,{panX:r,panY:s,zoomX:r+h.paper._viewBox[2]/2,zoomY:s+h.paper._viewBox[3]/2}),h.paper.setViewBox(r,s,h.paper._viewBox[2],h.paper._viewBox[3]),clearTimeout(h.panningTO),h.panningTO=setTimeout(function(){h.$map.trigger("afterPanning",{x1:r,y1:s,x2:r+h.paper._viewBox[2],y2:s+h.paper._viewBox[3]})},150),d=a,f=o,h.panning=!0),!1}})},mapPagePositionToXY:function(t,e){var a=this,o=a.$map.offset(),i=a.options.map.width?a.mapConf.width/a.options.map.width:a.mapConf.width/a.$map.width(),n=1/(1+a.zoomData.zoomLevel*a.options.map.zoom.step);return{x:n*i*(t-o.left)+a.zoomData.panX,y:n*i*(e-o.top)+a.zoomData.panY}},onZoomEvent:function(t,e){var a,o=this,i=o.zoomData.zoomLevel,n=0,r=0,s=1+o.zoomData.zoomLevel*o.options.map.zoom.step,p=e.animDuration!==L?e.animDuration:o.options.map.zoom.animDuration,l=0,m=0,h={};e.level!==L&&(i="string"==typeof e.level?"+"===e.level.slice(0,1)||"-"===e.level.slice(0,1)?o.zoomData.zoomLevel+parseInt(e.level):parseInt(e.level):e.level<0?o.zoomData.zoomLevel+e.level:e.level,i=Math.min(Math.max(i,o.options.map.zoom.minLevel),o.options.map.zoom.maxLevel)),a=1+i*o.options.map.zoom.step,e.latitude!==L&&e.longitude!==L&&(h=o.mapConf.getCoords(e.latitude,e.longitude),e.x=h.x,e.y=h.y),e.x===L&&(e.x=o.paper._viewBox[0]+o.paper._viewBox[2]/2),e.y===L&&(e.y=o.paper._viewBox[1]+o.paper._viewBox[3]/2),r=0===i?n=0:e.fixedCenter!==L&&!0===e.fixedCenter?(l=o.zoomData.panX+(e.x-o.zoomData.panX)*(a-s)/a,m=o.zoomData.panY+(e.y-o.zoomData.panY)*(a-s)/a,n=Math.min(Math.max(0,l),o.mapConf.width-o.mapConf.width/a),Math.min(Math.max(0,m),o.mapConf.height-o.mapConf.height/a)):(n=Math.min(Math.max(0,e.x-o.mapConf.width/a/2),o.mapConf.width-o.mapConf.width/a),Math.min(Math.max(0,e.y-o.mapConf.height/a/2),o.mapConf.height-o.mapConf.height/a)),a==s&&n==o.zoomData.panX&&r==o.zoomData.panY||(0<p?o.animateViewBox(n,r,o.mapConf.width/a,o.mapConf.height/a,p,o.options.map.zoom.animEasing):(o.paper.setViewBox(n,r,o.mapConf.width/a,o.mapConf.height/a),clearTimeout(o.zoomTO),o.zoomTO=setTimeout(function(){o.$map.trigger("afterZoom",{x1:n,y1:r,x2:n+o.mapConf.width/a,y2:r+o.mapConf.height/a})},150)),z.extend(o.zoomData,{zoomLevel:i,panX:n,panY:r,zoomX:n+o.paper._viewBox[2]/2,zoomY:r+o.paper._viewBox[3]/2}))},onShowElementsInRange:function(t,e){var a=this;e.animDuration===L&&(e.animDuration=0),e.hiddenOpacity===L&&(e.hiddenOpacity=.3),e.ranges&&e.ranges.area&&a.showElemByRange(e.ranges.area,a.areas,e.hiddenOpacity,e.animDuration),e.ranges&&e.ranges.plot&&a.showElemByRange(e.ranges.plot,a.plots,e.hiddenOpacity,e.animDuration),e.ranges&&e.ranges.link&&a.showElemByRange(e.ranges.link,a.links,e.hiddenOpacity,e.animDuration),e.afterShowRange&&e.afterShowRange()},showElemByRange:function(t,i,n,e){var a=this,r={};t.min===L&&t.max===L||(t={0:t}),z.each(t,function(a){var o=t[a];if(o.min===L&&o.max===L)return!0;z.each(i,function(t){var e=i[t].value;if("object"!=typeof e&&(e=[e]),e[a]===L)return!0;o.min!==L&&e[a]<o.min||o.max!==L&&e[a]>o.max?r[t]=n:r[t]=1})}),z.each(r,function(t){a.setElementOpacity(i[t],r[t],e)})},setElementOpacity:function(t,e,a){0<e&&(t.mapElem.show(),t.textElem&&t.textElem.show()),0<a?(t.mapElem.animate({opacity:e},a,"linear",function(){0===e&&t.mapElem.hide()}),t.textElem&&t.textElem.animate({opacity:e},a,"linear",function(){0===e&&t.textElem.hide()})):(t.mapElem.attr({opacity:e}),0===e&&t.mapElem.hide(),t.textElem&&(t.textElem.attr({opacity:e}),0===e&&t.textElem.hide()))},onUpdateEvent:function(t,a){var o=this;if("object"==typeof a){var e=0,i=a.animDuration?a.animDuration:0,n=function(t){o.unsetHover(t.mapElem,t.textElem),0<i?(t.mapElem.animate({opacity:0},i,"linear",function(){t.mapElem.remove()}),t.textElem&&t.textElem.animate({opacity:0},i,"linear",function(){t.textElem.remove()})):(t.mapElem.remove(),t.textElem&&t.textElem.remove())},r=function(t){t.mapElem.attr({opacity:0}),t.textElem&&t.textElem.attr({opacity:0}),o.setElementOpacity(t,t.mapElem.originalAttrs.opacity!==L?t.mapElem.originalAttrs.opacity:1,i)};if("object"==typeof a.mapOptions&&(!0===a.replaceOptions?o.options=o.extendDefaultOptions(a.mapOptions):z.extend(!0,o.options,a.mapOptions),a.mapOptions.areas===L&&a.mapOptions.plots===L&&a.mapOptions.legend===L||z("[data-type='elem']",o.$container).each(function(t,e){"1"===z(e).attr("data-hidden")&&z(e).trigger("click",[!1,i])})),"object"==typeof a.deletePlotKeys)for(;e<a.deletePlotKeys.length;e++)o.plots[a.deletePlotKeys[e]]!==L&&(n(o.plots[a.deletePlotKeys[e]]),delete o.plots[a.deletePlotKeys[e]]);else"all"===a.deletePlotKeys&&(z.each(o.plots,function(t,e){n(e)}),o.plots={});if("object"==typeof a.deleteLinkKeys)for(e=0;e<a.deleteLinkKeys.length;e++)o.links[a.deleteLinkKeys[e]]!==L&&(n(o.links[a.deleteLinkKeys[e]]),delete o.links[a.deleteLinkKeys[e]]);else"all"===a.deleteLinkKeys&&(z.each(o.links,function(t,e){n(e)}),o.links={});if("object"==typeof a.newPlots&&z.each(a.newPlots,function(t){o.plots[t]===L&&(o.options.plots[t]=a.newPlots[t],o.plots[t]=o.drawPlot(t),0<i&&r(o.plots[t]))}),"object"==typeof a.newLinks){var s=o.drawLinksCollection(a.newLinks);z.extend(o.links,s),z.extend(o.options.links,a.newLinks),0<i&&z.each(s,function(t){r(s[t])})}if(z.each(o.areas,function(t){if("object"==typeof a.mapOptions&&("object"==typeof a.mapOptions.map&&"object"==typeof a.mapOptions.map.defaultArea||"object"==typeof a.mapOptions.areas&&"object"==typeof a.mapOptions.areas[t]||"object"==typeof a.mapOptions.legend&&"object"==typeof a.mapOptions.legend.area)||!0===a.replaceOptions){var e=o.getElemOptions(o.options.map.defaultArea,o.options.areas[t]?o.options.areas[t]:{},o.options.legend.area);o.updateElem(e,o.areas[t],i)}}),z.each(o.plots,function(t){if("object"==typeof a.mapOptions&&("object"==typeof a.mapOptions.map&&"object"==typeof a.mapOptions.map.defaultPlot||"object"==typeof a.mapOptions.plots&&"object"==typeof a.mapOptions.plots[t]||"object"==typeof a.mapOptions.legend&&"object"==typeof a.mapOptions.legend.plot)||!0===a.replaceOptions){var e=o.getElemOptions(o.options.map.defaultPlot,o.options.plots[t]?o.options.plots[t]:{},o.options.legend.plot);"square"==e.type?(e.attrs.width=e.size,e.attrs.height=e.size,e.attrs.x=o.plots[t].mapElem.attrs.x-(e.size-o.plots[t].mapElem.attrs.width)/2,e.attrs.y=o.plots[t].mapElem.attrs.y-(e.size-o.plots[t].mapElem.attrs.height)/2):"image"==e.type?(e.attrs.width=e.width,e.attrs.height=e.height,e.attrs.x=o.plots[t].mapElem.attrs.x-(e.width-o.plots[t].mapElem.attrs.width)/2,e.attrs.y=o.plots[t].mapElem.attrs.y-(e.height-o.plots[t].mapElem.attrs.height)/2):"svg"==e.type?e.attrs.transform!==L&&(e.attrs.transform=o.plots[t].mapElem.baseTransform+e.attrs.transform):e.attrs.r=e.size/2,o.updateElem(e,o.plots[t],i)}}),z.each(o.links,function(t){if("object"==typeof a.mapOptions&&("object"==typeof a.mapOptions.map&&"object"==typeof a.mapOptions.map.defaultLink||"object"==typeof a.mapOptions.links&&"object"==typeof a.mapOptions.links[t])||!0===a.replaceOptions){var e=o.getElemOptions(o.options.map.defaultLink,o.options.links[t]?o.options.links[t]:{},{});o.updateElem(e,o.links[t],i)}}),a.mapOptions&&("object"==typeof a.mapOptions.legend||"object"==typeof a.mapOptions.map&&"object"==typeof a.mapOptions.map.defaultArea||"object"==typeof a.mapOptions.map&&"object"==typeof a.mapOptions.map.defaultPlot)&&(z("[data-type='elem']",o.$container).each(function(t,e){"1"===z(e).attr("data-hidden")&&z(e).trigger("click",[!1,i])}),o.createLegends("area",o.areas,1),o.options.map.width?o.createLegends("plot",o.plots,o.options.map.width/o.mapConf.width):o.createLegends("plot",o.plots,o.$map.width()/o.mapConf.width)),"object"==typeof a.setLegendElemsState)z.each(a.setLegendElemsState,function(t,a){var e=o.$container.find("."+t)[0];e!==L&&z("[data-type='elem']",e).each(function(t,e){("0"===z(e).attr("data-hidden")&&"hide"===a||"1"===z(e).attr("data-hidden")&&"show"===a)&&z(e).trigger("click",[!1,i])})});else{var p="hide"===a.setLegendElemsState?"hide":"show";z("[data-type='elem']",o.$container).each(function(t,e){("0"===z(e).attr("data-hidden")&&"hide"===p||"1"===z(e).attr("data-hidden")&&"show"===p)&&z(e).trigger("click",[!1,i])})}a.afterUpdate&&a.afterUpdate(o.$container,o.paper,o.areas,o.plots,o.options)}},drawLinksCollection:function(a){var o=this,i={},n={},r={},s={},p={};return z.each(a,function(t){var e=o.getElemOptions(o.options.map.defaultLink,a[t],{});i="string"==typeof a[t].between[0]?o.options.plots[a[t].between[0]]:a[t].between[0],n="string"==typeof a[t].between[1]?o.options.plots[a[t].between[1]]:a[t].between[1],i.latitude!==L&&i.longitude!==L?r=o.mapConf.getCoords(i.latitude,i.longitude):(r.x=i.x,r.y=i.y),n.latitude!==L&&n.longitude!==L?s=o.mapConf.getCoords(n.latitude,n.longitude):(s.x=n.x,s.y=n.y),p[t]=o.drawLink(t,r.x,r.y,s.x,s.y,e)}),p},drawLink:function(t,e,a,o,i,n){var r={},s=(e+o)/2,p=(a+i)/2,l=-1/((i-a)/(o-e)),m=p-l*s,h=Math.sqrt((o-e)*(o-e)+(i-a)*(i-a)),c=1+l*l,d=-2*s+2*l*m-2*l*p,f=d*d-4*c*(s*s+m*m-m*p-p*m+p*p-n.factor*h*(n.factor*h)),g=0,u=0;return u=0<n.factor?l*(g=(-d+Math.sqrt(f))/(2*c))+m:l*(g=(-d-Math.sqrt(f))/(2*c))+m,r.mapElem=this.paper.path("m "+e+","+a+" C "+g+","+u+" "+o+","+i+" "+o+","+i).attr(n.attrs),this.initElem(r,n,t),r},isAttrsChanged:function(t,e){for(var a in e)if(void 0===t[a]||e[a]!==t[a])return!0;return!1},updateElem:function(t,e,a){var o,i,n,r,s=this;t.value!==L&&(e.value=t.value),!0===t.toFront&&e.mapElem.toFront(),e.textElem&&(t.text!==L&&t.text.content!==L&&t.text.content!=e.textElem.attrs.text&&e.textElem.attr({text:t.text.content}),o=e.mapElem.getBBox(),(t.size||t.width&&t.height)&&(r="image"==t.type||"svg"==t.type?(n=(t.width-o.width)/2,(t.height-o.height)/2):(n=(t.size-o.width)/2,(t.size-o.height)/2),o.x-=n,o.x2+=n,o.y-=r,o.y2+=r),(i=s.getTextPosition(o,t.text.position,t.text.margin)).x==e.textElem.attrs.x&&i.y==e.textElem.attrs.y||(0<a?(e.textElem.attr({"text-anchor":i.textAnchor}),e.textElem.animate({x:i.x,y:i.y},a)):e.textElem.attr({x:i.x,y:i.y,"text-anchor":i.textAnchor})),s.setHoverOptions(e.textElem,t.text.attrs,t.text.attrsHover),0<a?e.textElem.animate(t.text.attrs,a):e.textElem.attr(t.text.attrs)),s.setHoverOptions(e.mapElem,t.attrs,t.attrsHover),s.isAttrsChanged(e.mapElem.attrs,t.attrs)&&(0<a?e.mapElem.animate(t.attrs,a):e.mapElem.attr(t.attrs)),"svg"==t.type&&(o===L&&(o=e.mapElem.getBBox()),e.mapElem.transform("m"+t.width/e.mapElem.originalWidth+",0,0,"+t.height/e.mapElem.originalHeight+","+o.x+","+o.y)),t.tooltip&&(e.mapElem.tooltip===L&&(s.setTooltip(e.mapElem),e.textElem&&s.setTooltip(e.textElem)),e.mapElem.tooltip=t.tooltip,e.textElem&&(e.textElem.tooltip=t.tooltip)),t.href!==L&&(e.mapElem.href===L&&(s.setHref(e.mapElem),e.textElem&&s.setHref(e.textElem)),e.mapElem.href=t.href,e.mapElem.target=t.target,e.textElem&&(e.textElem.href=t.href,e.textElem.target=t.target))},drawPlot:function(t){var e=this,a={},o={},i=e.getElemOptions(e.options.map.defaultPlot,e.options.plots[t]?e.options.plots[t]:{},e.options.legend.plot);if(i.x!==L&&i.y!==L)o={x:i.x,y:i.y};else if(i.plotsOn!==L&&e.areas[i.plotsOn].mapElem!==L){var n=e.areas[i.plotsOn].mapElem.getBBox();o={x:Math.floor(n.x+n.width/2),y:Math.floor(n.y+n.height/2)}}else o=e.mapConf.getCoords(i.latitude,i.longitude);return"square"==i.type?a={mapElem:e.paper.rect(o.x-i.size/2,o.y-i.size/2,i.size,i.size).attr(i.attrs)}:"image"==i.type?a={mapElem:e.paper.image(i.url,o.x-i.width/2,o.y-i.height/2,i.width,i.height).attr(i.attrs)}:"svg"==i.type?(i.attrs.transform===L&&(i.attrs.transform=""),(a={mapElem:e.paper.path(i.path)}).mapElem.originalWidth=a.mapElem.getBBox().width,a.mapElem.originalHeight=a.mapElem.getBBox().height,a.mapElem.baseTransform="m"+i.width/a.mapElem.originalWidth+",0,0,"+i.height/a.mapElem.originalHeight+","+(o.x-i.width/2)+","+(o.y-i.height/2),i.attrs.transform=a.mapElem.baseTransform+i.attrs.transform,a.mapElem.attr(i.attrs)):a={mapElem:e.paper.circle(o.x,o.y,i.size/2).attr(i.attrs)},e.initElem(a,i,t),a},setHref:function(t){var e=this;t.attr({cursor:"pointer"}),z(t.node).on("click."+g,function(){!e.panning&&t.href&&window.open(t.href,t.target)})},setTooltip:function(n){var r=this,t=0,a=r.$tooltip.attr("class"),o=function(t,e){var a=10,o=20;"object"==typeof n.tooltip.offset&&(void 0!==n.tooltip.offset.left&&(a=n.tooltip.offset.left),void 0!==n.tooltip.offset.top&&(o=n.tooltip.offset.top));var i={left:Math.min(r.$map.width()-r.$tooltip.outerWidth()-5,t-r.$map.offset().left+a),top:Math.min(r.$map.height()-r.$tooltip.outerHeight()-5,e-r.$map.offset().top+o)};"object"==typeof n.tooltip.overflow&&(!0===n.tooltip.overflow.right&&(i.left=t-r.$map.offset().left+10),!0===selem.tooltip.overflow.bottom&&(i.top=e-r.$map.offset().top+20)),r.$tooltip.css(i)};z(n.node).on("mouseover."+g,function(e){t=setTimeout(function(){if(r.$tooltip.attr("class",a),n.tooltip!==L){if(n.tooltip.content!==L){var t="function"==typeof n.tooltip.content?n.tooltip.content(n):n.tooltip.content;r.$tooltip.html(t).css("display","block")}n.tooltip.cssClass!==L&&r.$tooltip.addClass(n.tooltip.cssClass)}o(e.pageX,e.pageY)},120)}).on("mouseout."+g,function(){clearTimeout(t),r.$tooltip.css("display","none")}).on("mousemove."+g,function(t){o(t.pageX,t.pageY)})},setEventHandlers:function(a,o,i,n){var r=this;z.each(o.eventHandlers,function(t){var e;e=t,z(i.node).on(e,function(t){r.panning||o.eventHandlers[e](t,a,i,n,o)}),n&&z(n.node).on(e,function(t){r.panning||o.eventHandlers[e](t,a,i,n,o)})})},drawLegend:function(t,e,a,o,i){var n=this,r={},s={},p=0,l=0,m=null,h={},c={},d={},f=0,g=0,u=0,x=0,v=[],y=0;for(r=z("."+t.cssClass,n.$container),void 0===n.createdLegends[t.cssClass]&&(n.createdLegends[t.cssClass]={container:r,initialHTMLContent:r.html()}),r.empty(),s=new C(r.get(0)),z(s.canvas).attr({"data-type":e,"data-index":i}),l=p=0,t.title&&""!==t.title&&((m=s.text(t.marginLeftTitle,0,t.title).attr(t.titleAttrs)).attr({y:.5*m.getBBox().height}),p=t.marginLeftTitle+m.getBBox().width,l+=t.marginBottomTitle+m.getBBox().height),f=0,y=t.slices.length;f<y;++f){var E=0;v[f]=z.extend(!0,{},"plot"==e?n.options.map.defaultPlot:n.options.map.defaultArea,t.slices[f]),t.slices[f].legendSpecificAttrs===L&&(t.slices[f].legendSpecificAttrs={}),z.extend(!0,v[f].attrs,t.slices[f].legendSpecificAttrs),"area"==e?(v[f].attrs.width===L&&(v[f].attrs.width=30),v[f].attrs.height===L&&(v[f].attrs.height=20)):"square"==v[f].type?(v[f].attrs.width===L&&(v[f].attrs.width=v[f].size),v[f].attrs.height===L&&(v[f].attrs.height=v[f].size)):"image"==v[f].type||"svg"==v[f].type?(v[f].attrs.width===L&&(v[f].attrs.width=v[f].width),v[f].attrs.height===L&&(v[f].attrs.height=v[f].height)):v[f].attrs.r===L&&(v[f].attrs.r=v[f].size/2),E=t.marginBottomTitle,m&&(E+=m.getBBox().height),"plot"!=e||v[f].type!==L&&"circle"!=v[f].type?E+=o*v[f].attrs.height/2:E+=o*v[f].attrs.r,x=Math.max(x,E)}for("horizontal"==t.mode&&(p=t.marginLeft),f=0,y=v.length;f<y;++f)if(v[f].display===L||!0===v[f].display){if("area"==e?(u="horizontal"==t.mode?(g=p+t.marginLeft,x-.5*o*v[f].attrs.height):(g=t.marginLeft,l),h=s.rect(g,u,o*v[f].attrs.width,o*v[f].attrs.height)):"square"==v[f].type?(u="horizontal"==t.mode?(g=p+t.marginLeft,x-.5*o*v[f].attrs.height):(g=t.marginLeft,l),h=s.rect(g,u,o*v[f].attrs.width,o*v[f].attrs.height)):"image"==v[f].type||"svg"==v[f].type?(u="horizontal"==t.mode?(g=p+t.marginLeft,x-.5*o*v[f].attrs.height):(g=t.marginLeft,l),"image"==v[f].type?h=s.image(v[f].url,g,u,o*v[f].attrs.width,o*v[f].attrs.height):(h=s.path(v[f].path),v[f].attrs.transform===L&&(v[f].attrs.transform=""),v[f].attrs.transform="m"+o*v[f].width/h.getBBox().width+",0,0,"+o*v[f].height/h.getBBox().height+","+g+","+u+v[f].attrs.transform)):(u="horizontal"==t.mode?(g=p+t.marginLeft+o*v[f].attrs.r,x):(g=t.marginLeft+o*v[f].attrs.r,l+o*v[f].attrs.r),h=s.circle(g,u,o*v[f].attrs.r)),delete v[f].attrs.width,delete v[f].attrs.height,delete v[f].attrs.r,h.attr(v[f].attrs),c=h.getBBox(),u="horizontal"==t.mode?(g=p+t.marginLeft+c.width+t.marginLeftLabel,x):(g=t.marginLeft+c.width+t.marginLeftLabel,l+c.height/2),d=s.text(g,u,v[f].label).attr(t.labelAttrs),"horizontal"==t.mode){var w=t.marginBottom+c.height;p+=t.marginLeft+c.width+t.marginLeftLabel+d.getBBox().width,"image"!=v[f].type&&"area"!=e&&(w+=t.marginBottomTitle),m&&(w+=m.getBBox().height),l=Math.max(l,w)}else p=Math.max(p,t.marginLeft+c.width+t.marginLeftLabel+d.getBBox().width),l+=t.marginBottom+c.height;z(h.node).attr({"data-type":"elem","data-index":f,"data-hidden":0}),z(d.node).attr({"data-type":"label","data-index":f,"data-hidden":0}),t.hideElemsOnClick.enabled&&(d.attr({cursor:"pointer"}),h.attr({cursor:"pointer"}),n.setHoverOptions(h,v[f].attrs,v[f].attrs),n.setHoverOptions(d,t.labelAttrs,t.labelAttrsHover),n.setHover(h,d),n.handleClickOnLegendElem(t,t.slices[f],d,h,a,i))}"SVG"!=C.type&&t.VMLWidth&&(p=t.VMLWidth),s.setSize(p,l)},handleClickOnLegendElem:function(r,s,p,l,m,h){var c=this,t=function(t,e,o){var i=0,n=z(p.node).attr("data-hidden"),a="0"===n?{"data-hidden":"1"}:{"data-hidden":"0"};o===L&&(o=r.hideElemsOnClick.animDuration),"0"===n?0<o?p.animate({opacity:.5},o):p.attr({opacity:.5}):0<o?p.animate({opacity:1},o):p.attr({opacity:1}),z.each(m,function(t){var e,a=m[t].mapElem.data("hidden-by");a===L&&(a={}),i=z.isArray(m[t].value)?m[t].value[h]:m[t].value,c.getLegendSlice(i,r)===s&&(e=t,"0"===n?(a[h]=!0,c.setElementOpacity(m[e],r.hideElemsOnClick.opacity,o)):(delete a[h],z.isEmptyObject(a)&&c.setElementOpacity(m[e],m[e].mapElem.originalAttrs.opacity!==L?m[e].mapElem.originalAttrs.opacity:1,o)),m[e].mapElem.data("hidden-by",a))}),z(l.node).attr(a),z(p.node).attr(a),e!==L&&!0!==e||r.exclusive===L||!0!==r.exclusive||z("[data-type='elem'][data-hidden=0]",c.$container).each(function(){z(this).attr("data-index")!==z(l.node).attr("data-index")&&z(this).trigger("click",!1)})};z(p.node).on("click."+g,t),z(l.node).on("click."+g,t),s.clicked!==L&&!0===s.clicked&&z(l.node).trigger("click",!1)},createLegends:function(t,e,a){var o=this,i=o.options.legend[t];z.isArray(o.options.legend[t])||(i=[o.options.legend[t]]);for(var n=0;n<i.length;++n){if(""===i[n].cssClass||0===z("."+i[n].cssClass,o.$container).length)throw new Error("The legend class `"+i[n].cssClass+"` doesn't exists.");!0===i[n].display&&z.isArray(i[n].slices)&&0<i[n].slices.length&&o.drawLegend(i[n],t,e,a,n)}},setHoverOptions:function(t,e,a){"SVG"!=C.type&&delete a.transform,t.attrsHover=a,t.attrsHover.transform?t.originalAttrs=z.extend({transform:"s1"},e):t.originalAttrs=e},setHover:function(t,e){var a=this,o={},i=0,n=0,r=function(){clearTimeout(n),i=setTimeout(function(){a.elemHover(t,e)},120)},s=function(){clearTimeout(i),n=setTimeout(function(){a.elemOut(t,e)},120)};(o=z(t.node)).on("mouseover."+g,r),o.on("mouseout."+g,s),e&&(z(e.node).on("mouseover."+g,r),z(e.node).on("mouseout."+g,s))},unsetHover:function(t,e){z(t.node).off("."+g),e&&z(e.node).off("."+g)},elemHover:function(t,e){0<t.attrsHover.animDuration?t.animate(t.attrsHover,t.attrsHover.animDuration):t.attr(t.attrsHover),e&&(0<e.attrsHover.animDuration?e.animate(e.attrsHover,e.attrsHover.animDuration):e.attr(e.attrsHover)),this.paper.safari&&this.paper.safari()},elemOut:function(t,e){0<t.attrsHover.animDuration?t.animate(t.originalAttrs,t.attrsHover.animDuration):t.attr(t.originalAttrs),e&&(0<e.attrsHover.animDuration?e.animate(e.originalAttrs,e.attrsHover.animDuration):e.attr(e.originalAttrs)),this.paper.safari&&this.paper.safari()},getElemOptions:function(t,e,a){var o=z.extend(!0,{},t,e);if(o.value!==L)if(z.isArray(a))for(var i=0,n=a.length;i<n;++i)o=z.extend(!0,{},o,this.getLegendSlice(o.value[i],a[i]));else o=z.extend(!0,{},o,this.getLegendSlice(o.value,a));return o},getTextPosition:function(t,e,a){var o=0,i=0,n="";switch("number"==typeof a&&(a="bottom"===e||"top"===e?{x:0,y:a}:"right"===e||"left"===e?{x:a,y:0}:{x:0,y:0}),e){case"bottom":o=(t.x+t.x2)/2+a.x,i=t.y2+a.y,n="middle";break;case"top":o=(t.x+t.x2)/2+a.x,i=t.y-a.y,n="middle";break;case"left":o=t.x-a.x,i=(t.y+t.y2)/2+a.y,n="end";break;case"right":o=t.x2+a.x,i=(t.y+t.y2)/2+a.y,n="start";break;default:o=(t.x+t.x2)/2+a.x,i=(t.y+t.y2)/2+a.y,n="middle"}return{x:o,y:i,textAnchor:n}},getLegendSlice:function(t,e){for(var a=0,o=e.slices.length;a<o;++a)if(e.slices[a].sliceValue!==L&&t==e.slices[a].sliceValue||e.slices[a].sliceValue===L&&(e.slices[a].min===L||t>=e.slices[a].min)&&(e.slices[a].max===L||t<=e.slices[a].max))return e.slices[a];return{}},animateViewBox:function(e,a,o,i,t,n){var r,s=this,p=s.paper._viewBox?s.paper._viewBox[0]:0,l=e-p,m=s.paper._viewBox?s.paper._viewBox[1]:0,h=a-m,c=s.paper._viewBox?s.paper._viewBox[2]:s.paper.width,d=o-c,f=s.paper._viewBox?s.paper._viewBox[3]:s.paper.height,g=i-f,u=t/25,x=0;n=n||"linear",r=C.easing_formulas[n],clearInterval(s.animationIntervalID),s.animationIntervalID=setInterval(function(){var t=x/u;s.paper.setViewBox(p+l*r(t),m+h*r(t),c+d*r(t),f+g*r(t),!1),x++>=u&&(clearInterval(s.animationIntervalID),clearTimeout(s.zoomTO),s.zoomTO=setTimeout(function(){s.$map.trigger("afterZoom",{x1:e,y1:a,x2:e+o,y2:a+i})},150))},25)},isRaphaelBBoxBugPresent:function(){var t=this.paper.text(-50,-50,"TEST"),e=t.getBBox();return t.remove(),0===e.width&&0===e.height},defaultOptions:{map:{cssClass:"map",tooltip:{cssClass:"mapTooltip"},defaultArea:{attrs:{fill:"#343434",stroke:"#5d5d5d","stroke-width":1,"stroke-linejoin":"round"},attrsHover:{fill:"#f38a03",animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self",cssClass:"area"},defaultPlot:{type:"circle",size:15,attrs:{fill:"#0088db",stroke:"#fff","stroke-width":0,"stroke-linejoin":"round"},attrsHover:{"stroke-width":3,animDuration:300},text:{position:"right",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self",cssClass:"plot"},defaultLink:{factor:.5,attrs:{stroke:"#0088db","stroke-width":2},attrsHover:{animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self",cssClass:"link"},zoom:{enabled:!1,minLevel:0,maxLevel:10,step:.25,mousewheel:!0,touch:!0,animDuration:200,animEasing:"linear",buttons:{reset:{cssClass:"zoomButton zoomReset",content:"&#8226;",title:"Reset zoom"},in:{cssClass:"zoomButton zoomIn",content:"+",title:"Zoom in"},out:{cssClass:"zoomButton zoomOut",content:"&#8722;",title:"Zoom out"}}}},legend:{redrawOnResize:!0,area:[],plot:[]},areas:{},plots:{},links:{}},legendDefaultOptions:{area:{cssClass:"areaLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2,animDuration:300},slices:[],mode:"vertical"},plot:{cssClass:"plotLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2,animDuration:300},slices:[],mode:"vertical"}}},z[g]===L&&(z[g]=i),z.fn[g]=function(t){return this.each(function(){z.data(this,g)&&z.data(this,g).destroy(),z.data(this,g,new i(this,t))})},i});