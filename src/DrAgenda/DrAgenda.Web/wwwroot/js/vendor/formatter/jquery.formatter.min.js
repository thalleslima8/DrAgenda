!function(t,e){"function"==typeof define&&define.amd?define(["jQuery"],e):"object"==typeof exports?e(require("jQuery")):e(t.jQuery)}(this,function(t){var e,o,h,i,s=(e={},o=new RegExp("{{([^}]+)}}","g"),e.parse=function(t){for(var n={inpts:{},chars:{}},e=function(t){for(var e,s=[];e=o.exec(t);)s.push(e);return s}(t),s=t.length,i=0,r=0,a=0,h=function(t){for(var e=t.length,s=0;s<e;s++)n.inpts[r]=t.charAt(s),r++;i++,a+=t.length+4-1};a<s;a++)i<e.length&&a===e[i].index?h(e[i][1]):n.chars[a-4*i]=t.charAt(a);return n.mLength=a-4*i,n},e),n=function(){var s={};"undefined"!=typeof navigator&&navigator.userAgent;return s.extend=function(t){for(var e=1;e<arguments.length;e++)for(var s in arguments[e])t[s]=arguments[e][s];return t},s.addChars=function(t,e,s){return t.substr(0,s)+e+t.substr(s,t.length)},s.removeChars=function(t,e,s){return t.substr(0,e)+t.substr(s,t.length)},s.isBetween=function(t,e){return e.sort(function(t,e){return t-e}),t>e[0]&&t<e[1]},s.addListener=function(t,e,s){return void 0!==t.addEventListener?t.addEventListener(e,s,!1):t.attachEvent("on"+e,s)},s.preventDefault=function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1},s.getClip=function(t){return t.clipboardData?t.clipboardData.getData("Text"):window.clipboardData?window.clipboardData.getData("Text"):void 0},s.getMatchingKey=function(t,e,s){for(var n in s){var i=s[n];if(t===i.which&&e===i.keyCode)return n}},s.isDelKeyDown=function(t,e){return s.getMatchingKey(t,e,{backspace:{which:8,keyCode:8},delete:{which:46,keyCode:46}})},s.isDelKeyPress=function(t,e){return s.getMatchingKey(t,e,{backspace:{which:8,keyCode:8,shiftKey:!1},delete:{which:0,keyCode:46}})},s.isSpecialKeyPress=function(t,e){return s.getMatchingKey(t,e,{tab:{which:0,keyCode:9},enter:{which:13,keyCode:13},end:{which:0,keyCode:35},home:{which:0,keyCode:36},leftarrow:{which:0,keyCode:37},uparrow:{which:0,keyCode:38},rightarrow:{which:0,keyCode:39},downarrow:{which:0,keyCode:40},F5:{which:116,keyCode:116}})},s.isModifier=function(t){return t.ctrlKey||t.altKey||t.metaKey},s.forEach=function(t,e,s){if(t.hasOwnProperty("length"))for(var n=0,i=t.length;n<i&&!1!==e.call(s,t[n],n,t);n++);else for(var r in t)if(t.hasOwnProperty(r)&&!1===e.call(s,t[r],r,t))break},s}(),r=function(n,i,a){var r={persistent:!1,repeat:!1,placeholder:" "},h={9:/[0-9]/,a:/[A-Za-z]/,"*":/[A-Za-z0-9]/};function t(t,e){var s=this;if(s.el=t,!s.el)throw new TypeError("Must provide an existing element");if(s.opts=a.extend({},r,e),void 0!==s.opts.pattern&&(s.opts.patterns=s._specFromSinglePattern(s.opts.pattern),delete s.opts.pattern),void 0===s.opts.patterns)throw new TypeError("Must provide a pattern or array of patterns");s.patternMatcher=n(s.opts.patterns),s._updatePattern(),s.hldrs={},s.focus=0,a.addListener(s.el,"keydown",function(t){s._keyDown(t)}),a.addListener(s.el,"keypress",function(t){s._keyPress(t)}),a.addListener(s.el,"paste",function(t){s._paste(t)}),s.opts.persistent&&(s._processKey("",!1),s.el.blur(),a.addListener(s.el,"focus",function(t){s._focus(t)}),a.addListener(s.el,"click",function(t){s._focus(t)}),a.addListener(s.el,"touchstart",function(t){s._focus(t)}))}return t.addInptType=function(t,e){h[t]=e},t.prototype.resetPattern=function(t){this.opts.patterns=t?this._specFromSinglePattern(t):this.opts.patterns,this.sel=i.get(this.el),this.val=this.el.value,this.delta=0,this._removeChars(),this.patternMatcher=n(this.opts.patterns);var e=this.patternMatcher.getPattern(this.val);this.mLength=e.mLength,this.chars=e.chars,this.inpts=e.inpts,this._processKey("",!1,!0)},t.prototype._updatePattern=function(){var t=this.patternMatcher.getPattern(this.val);t&&(this.mLength=t.mLength,this.chars=t.chars,this.inpts=t.inpts)},t.prototype._keyDown=function(t){var e=t.which||t.keyCode;if(e&&a.isDelKeyDown(t.which,t.keyCode))return this._processKey(null,e),a.preventDefault(t)},t.prototype._keyPress=function(t){var e,s;if(e=t.which||t.keyCode,s=a.isSpecialKeyPress(t.which,t.keyCode),!a.isDelKeyPress(t.which,t.keyCode)&&!s&&!a.isModifier(t))return this._processKey(String.fromCharCode(e),!1),a.preventDefault(t)},t.prototype._paste=function(t){return this._processKey(a.getClip(t),!1),a.preventDefault(t)},t.prototype._focus=function(){var n=this;setTimeout(function(){var t=i.get(n.el),e=t.end>n.focus,s=0===t.end;(e||s)&&i.set(n.el,n.focus)},0)},t.prototype._processKey=function(t,e,s){if(this.sel=i.get(this.el),this.val=this.el.value,this.delta=0,this.sel.begin!==this.sel.end)this.delta=-1*Math.abs(this.sel.begin-this.sel.end),this.val=a.removeChars(this.val,this.sel.begin,this.sel.end);else if(e&&46===e)this._delete();else if(e&&0<=this.sel.begin-1)this.val=a.removeChars(this.val,this.sel.end-1,this.sel.end),this.delta-=1;else if(e)return!0;e||(this.val=a.addChars(this.val,t,this.sel.begin),this.delta+=t.length),this._formatValue(s)},t.prototype._delete=function(){for(;this.chars[this.sel.begin];)this._nextPos();this.sel.begin<this.val.length&&(this._nextPos(),this.val=a.removeChars(this.val,this.sel.end-1,this.sel.end),this.delta=-1)},t.prototype._nextPos=function(){this.sel.end++,this.sel.begin++},t.prototype._formatValue=function(t){this.newPos=this.sel.end+this.delta,this._removeChars(),this._updatePattern(),this._validateInpts(),this._addChars(),this.el.value=this.val.substr(0,this.mLength),void 0!==t&&!1!==t||i.set(this.el,this.newPos)},t.prototype._removeChars=function(){this.sel.end>this.focus&&(this.delta+=this.sel.end-this.focus);for(var t=0,e=0;e<=this.mLength;e++){var s,n=this.chars[e],i=this.hldrs[e],r=e+t;r=e>=this.sel.begin?r+this.delta:r,s=this.val.charAt(r),(n&&n===s||i&&i===s)&&(this.val=a.removeChars(this.val,r,r+1),t--)}this.hldrs={},this.focus=this.val.length},t.prototype._validateInpts=function(){for(var t=0;t<this.val.length;t++){var e=this.inpts[t],s=!h[e],n=!s&&!h[e].test(this.val.charAt(t)),i=this.inpts[t];(s||n)&&i&&(this.val=a.removeChars(this.val,t,t+1),this.focusStart--,this.newPos--,this.delta--,t--)}},t.prototype._addChars=function(){if(this.opts.persistent){for(var t=0;t<=this.mLength;t++)this.val.charAt(t)||(this.val=a.addChars(this.val,this.opts.placeholder,t),this.hldrs[t]=this.opts.placeholder),this._addChar(t);for(;this.chars[this.focus];)this.focus++}else for(var e=0;e<=this.val.length;e++){if(this.delta<=0&&e===this.focus)return!0;this._addChar(e)}},t.prototype._addChar=function(t){var e=this.chars[t];if(!e)return!0;a.isBetween(t,[this.sel.begin-1,this.newPos+1])&&(this.newPos++,this.delta++),t<=this.focus&&this.focus++,this.hldrs[t]&&(delete this.hldrs[t],this.hldrs[t+1]=this.opts.placeholder),this.val=a.addChars(this.val,e,t)},t.prototype._specFromSinglePattern=function(t){return[{"*":t}]},t}((h=s,i=n,function(t){var r=[],a=[];return i.forEach(t,function(t){i.forEach(t,function(t,e){var s,n=h.parse(t),i="*"===(s=e)?/.*/:new RegExp(s);return r.push(i),a.push(n),!1})}),{getPattern:function(s){var n;return i.forEach(r,function(t,e){if(t.test(s))return n=e,!1}),void 0===n?null:a[n]},patterns:a,matchers:r}}),{get:function(t){if("number"==typeof t.selectionStart)return{begin:t.selectionStart,end:t.selectionEnd};var e=document.selection.createRange();if(e&&e.parentElement()===t){var s=t.createTextRange(),n=t.createTextRange(),i=t.value.length;return s.moveToBookmark(e.getBookmark()),n.collapse(!1),-1<s.compareEndPoints("StartToEnd",n)?{begin:i,end:i}:{begin:-s.moveStart("character",-i),end:-s.moveEnd("character",-i)}}return{begin:0,end:0}},set:function(t,e){if("object"!=typeof e&&(e={begin:e,end:e}),t.setSelectionRange)t.focus(),t.setSelectionRange(e.begin,e.end);else if(t.createTextRange){var s=t.createTextRange();s.collapse(!0),s.moveEnd("character",e.end),s.moveStart("character",e.begin),s.select()}}},n),a="formatter";$.fn[a]=function(t){return"object"==typeof t&&this.each(function(){$.data(this,"plugin_"+a)||$.data(this,"plugin_"+a,new r(this,t))}),this.resetPattern=function(e){return this.each(function(){var t=$.data(this,"plugin_"+a);t&&t.resetPattern(e)}),this},this},$.fn[a].addInptType=function(t,e){r.addInptType(t,e)}});