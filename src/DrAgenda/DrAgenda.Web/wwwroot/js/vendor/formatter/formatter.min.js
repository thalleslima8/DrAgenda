!function(e,t){"function"==typeof define&&define.amd?define([],function(){return e.returnExportsGlobal=t()}):"object"==typeof exports?module.exports=t():e.Formatter=t()}(this,function(){var e,o,h,t,s=(e={},o=new RegExp("{{([^}]+)}}","g"),e.parse=function(e){for(var n={inpts:{},chars:{}},t=function(e){for(var t,s=[];t=o.exec(e);)s.push(t);return s}(e),s=e.length,r=0,i=0,a=0,h=function(e){for(var t=e.length,s=0;s<t;s++)n.inpts[i]=e.charAt(s),i++;r++,a+=e.length+4-1};a<s;a++)r<t.length&&a===t[r].index?h(t[r][1]):n.chars[a-4*r]=e.charAt(a);return n.mLength=a-4*r,n},e),n=function(){var s={};"undefined"!=typeof navigator&&navigator.userAgent;return s.extend=function(e){for(var t=1;t<arguments.length;t++)for(var s in arguments[t])e[s]=arguments[t][s];return e},s.addChars=function(e,t,s){return e.substr(0,s)+t+e.substr(s,e.length)},s.removeChars=function(e,t,s){return e.substr(0,t)+e.substr(s,e.length)},s.isBetween=function(e,t){return t.sort(function(e,t){return e-t}),e>t[0]&&e<t[1]},s.addListener=function(e,t,s){return void 0!==e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent("on"+t,s)},s.preventDefault=function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1},s.getClip=function(e){return e.clipboardData?e.clipboardData.getData("Text"):window.clipboardData?window.clipboardData.getData("Text"):void 0},s.getMatchingKey=function(e,t,s){for(var n in s){var r=s[n];if(e===r.which&&t===r.keyCode)return n}},s.isDelKeyDown=function(e,t){return s.getMatchingKey(e,t,{backspace:{which:8,keyCode:8},delete:{which:46,keyCode:46}})},s.isDelKeyPress=function(e,t){return s.getMatchingKey(e,t,{backspace:{which:8,keyCode:8,shiftKey:!1},delete:{which:0,keyCode:46}})},s.isSpecialKeyPress=function(e,t){return s.getMatchingKey(e,t,{tab:{which:0,keyCode:9},enter:{which:13,keyCode:13},end:{which:0,keyCode:35},home:{which:0,keyCode:36},leftarrow:{which:0,keyCode:37},uparrow:{which:0,keyCode:38},rightarrow:{which:0,keyCode:39},downarrow:{which:0,keyCode:40},F5:{which:116,keyCode:116}})},s.isModifier=function(e){return e.ctrlKey||e.altKey||e.metaKey},s.forEach=function(e,t,s){if(e.hasOwnProperty("length"))for(var n=0,r=e.length;n<r&&!1!==t.call(s,e[n],n,e);n++);else for(var i in e)if(e.hasOwnProperty(i)&&!1===t.call(s,e[i],i,e))break},s}();return function(n,r,a){var i={persistent:!1,repeat:!1,placeholder:" "},h={9:/[0-9]/,a:/[A-Za-z]/,"*":/[A-Za-z0-9]/};function e(e,t){var s=this;if(s.el=e,!s.el)throw new TypeError("Must provide an existing element");if(s.opts=a.extend({},i,t),void 0!==s.opts.pattern&&(s.opts.patterns=s._specFromSinglePattern(s.opts.pattern),delete s.opts.pattern),void 0===s.opts.patterns)throw new TypeError("Must provide a pattern or array of patterns");s.patternMatcher=n(s.opts.patterns),s._updatePattern(),s.hldrs={},s.focus=0,a.addListener(s.el,"keydown",function(e){s._keyDown(e)}),a.addListener(s.el,"keypress",function(e){s._keyPress(e)}),a.addListener(s.el,"paste",function(e){s._paste(e)}),s.opts.persistent&&(s._processKey("",!1),s.el.blur(),a.addListener(s.el,"focus",function(e){s._focus(e)}),a.addListener(s.el,"click",function(e){s._focus(e)}),a.addListener(s.el,"touchstart",function(e){s._focus(e)}))}return e.addInptType=function(e,t){h[e]=t},e.prototype.resetPattern=function(e){this.opts.patterns=e?this._specFromSinglePattern(e):this.opts.patterns,this.sel=r.get(this.el),this.val=this.el.value,this.delta=0,this._removeChars(),this.patternMatcher=n(this.opts.patterns);var t=this.patternMatcher.getPattern(this.val);this.mLength=t.mLength,this.chars=t.chars,this.inpts=t.inpts,this._processKey("",!1,!0)},e.prototype._updatePattern=function(){var e=this.patternMatcher.getPattern(this.val);e&&(this.mLength=e.mLength,this.chars=e.chars,this.inpts=e.inpts)},e.prototype._keyDown=function(e){var t=e.which||e.keyCode;if(t&&a.isDelKeyDown(e.which,e.keyCode))return this._processKey(null,t),a.preventDefault(e)},e.prototype._keyPress=function(e){var t,s;if(t=e.which||e.keyCode,s=a.isSpecialKeyPress(e.which,e.keyCode),!a.isDelKeyPress(e.which,e.keyCode)&&!s&&!a.isModifier(e))return this._processKey(String.fromCharCode(t),!1),a.preventDefault(e)},e.prototype._paste=function(e){return this._processKey(a.getClip(e),!1),a.preventDefault(e)},e.prototype._focus=function(){var n=this;setTimeout(function(){var e=r.get(n.el),t=e.end>n.focus,s=0===e.end;(t||s)&&r.set(n.el,n.focus)},0)},e.prototype._processKey=function(e,t,s){if(this.sel=r.get(this.el),this.val=this.el.value,this.delta=0,this.sel.begin!==this.sel.end)this.delta=-1*Math.abs(this.sel.begin-this.sel.end),this.val=a.removeChars(this.val,this.sel.begin,this.sel.end);else if(t&&46===t)this._delete();else if(t&&0<=this.sel.begin-1)this.val=a.removeChars(this.val,this.sel.end-1,this.sel.end),this.delta-=1;else if(t)return!0;t||(this.val=a.addChars(this.val,e,this.sel.begin),this.delta+=e.length),this._formatValue(s)},e.prototype._delete=function(){for(;this.chars[this.sel.begin];)this._nextPos();this.sel.begin<this.val.length&&(this._nextPos(),this.val=a.removeChars(this.val,this.sel.end-1,this.sel.end),this.delta=-1)},e.prototype._nextPos=function(){this.sel.end++,this.sel.begin++},e.prototype._formatValue=function(e){this.newPos=this.sel.end+this.delta,this._removeChars(),this._updatePattern(),this._validateInpts(),this._addChars(),this.el.value=this.val.substr(0,this.mLength),void 0!==e&&!1!==e||r.set(this.el,this.newPos)},e.prototype._removeChars=function(){this.sel.end>this.focus&&(this.delta+=this.sel.end-this.focus);for(var e=0,t=0;t<=this.mLength;t++){var s,n=this.chars[t],r=this.hldrs[t],i=t+e;i=t>=this.sel.begin?i+this.delta:i,s=this.val.charAt(i),(n&&n===s||r&&r===s)&&(this.val=a.removeChars(this.val,i,i+1),e--)}this.hldrs={},this.focus=this.val.length},e.prototype._validateInpts=function(){for(var e=0;e<this.val.length;e++){var t=this.inpts[e],s=!h[t],n=!s&&!h[t].test(this.val.charAt(e)),r=this.inpts[e];(s||n)&&r&&(this.val=a.removeChars(this.val,e,e+1),this.focusStart--,this.newPos--,this.delta--,e--)}},e.prototype._addChars=function(){if(this.opts.persistent){for(var e=0;e<=this.mLength;e++)this.val.charAt(e)||(this.val=a.addChars(this.val,this.opts.placeholder,e),this.hldrs[e]=this.opts.placeholder),this._addChar(e);for(;this.chars[this.focus];)this.focus++}else for(var t=0;t<=this.val.length;t++){if(this.delta<=0&&t===this.focus)return!0;this._addChar(t)}},e.prototype._addChar=function(e){var t=this.chars[e];if(!t)return!0;a.isBetween(e,[this.sel.begin-1,this.newPos+1])&&(this.newPos++,this.delta++),e<=this.focus&&this.focus++,this.hldrs[e]&&(delete this.hldrs[e],this.hldrs[e+1]=this.opts.placeholder),this.val=a.addChars(this.val,t,e)},e.prototype._specFromSinglePattern=function(e){return[{"*":e}]},e}((h=s,t=n,function(e){var i=[],a=[];return t.forEach(e,function(e){t.forEach(e,function(e,t){var s,n=h.parse(e),r="*"===(s=t)?/.*/:new RegExp(s);return i.push(r),a.push(n),!1})}),{getPattern:function(s){var n;return t.forEach(i,function(e,t){if(e.test(s))return n=t,!1}),void 0===n?null:a[n]},patterns:a,matchers:i}}),{get:function(e){if("number"==typeof e.selectionStart)return{begin:e.selectionStart,end:e.selectionEnd};var t=document.selection.createRange();if(t&&t.parentElement()===e){var s=e.createTextRange(),n=e.createTextRange(),r=e.value.length;return s.moveToBookmark(t.getBookmark()),n.collapse(!1),-1<s.compareEndPoints("StartToEnd",n)?{begin:r,end:r}:{begin:-s.moveStart("character",-r),end:-s.moveEnd("character",-r)}}return{begin:0,end:0}},set:function(e,t){if("object"!=typeof t&&(t={begin:t,end:t}),e.setSelectionRange)e.focus(),e.setSelectionRange(t.begin,t.end);else if(e.createTextRange){var s=e.createTextRange();s.collapse(!0),s.moveEnd("character",t.end),s.moveStart("character",t.begin),s.select()}}},n)});